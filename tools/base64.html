---
layout: null
title: "Base64 ç¼–è§£ç "
description: "æ–‡æœ¬ç¼–ç ã€base64"
---
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ§© Base64 ç¼–è§£ç </title>
  <style>
    /* å¼ºåˆ¶ç™½åº• + æ·±è‰²æ–‡å­—ï¼ˆä¸è·Ÿéšç³»ç»Ÿæš—è‰²ï¼‰ */
    :root { color-scheme: light; }
    html, body { background:#fff; color:#111; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    }
    .page{ max-width: 1200px; margin:0 auto; background:#fff; }

    /* é¡¶éƒ¨æ ‡é¢˜åŒº */
    .topbar{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
      padding:14px 16px;
      border-bottom:1px solid #e5e7eb;
      background:#fff;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; font-size:26px;
      color:#111;
    }

    .wrap{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      padding:14px 16px 18px;
      background:#fff;
    }
    @media (max-width: 980px){ .wrap{ grid-template-columns:1fr; } }

    .card{
      border:1px solid #e5e7eb;
      border-radius:12px;
      overflow:hidden;
      background:#fff;
    }
    .card .title{
      padding:12px 14px;
      font-weight:800;
      border-bottom:1px solid #e5e7eb;
      background:#f9fafb;
      color:#111;
    }
    .card .content{ padding:12px 14px; background:#fff; }

    label{ display:block; margin:0 0 8px; font-weight:700; color:#111; }
    .hintline{ font-size:13px; color:#4b5563; margin: 0 0 10px; }

    textarea, input[type="file"], button{
      font:inherit;
      border-radius:10px;
      border:1px solid #d1d5db;
      background:#fff;
      padding:10px 12px;
      outline:none;
      color:#111;
    }
    textarea{
      width:100%;
      min-height: 170px;
      resize: vertical;
      line-height:1.45;
    }
    textarea::placeholder { color:#9ca3af; }

    .btnrow{
      display:flex; flex-wrap:wrap;
      gap:10px; align-items:center;
      margin:10px 0 10px;
    }
    button{ cursor:pointer; }
    .btn-primary{
      background:#2563eb;
      color:#fff;
      border-color:#2563eb;
      font-weight:800;
      padding:10px 16px;
    }
    .btn-ghost{
      border-color:#d1d5db;
      background:#fff;
      color:#111;
      font-weight:700;
      padding:10px 16px;
    }
    .swapIcon{
      font-weight:900;
      letter-spacing: 2px;
      font-size: 16px;
    }

    .shortcut{
      font-weight:700;
      color:#6b7280;
      display:flex;
      align-items:center;
      gap:6px;
      margin-left:6px;
    }
    kbd{
      font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      border:1px solid #d1d5db;
      padding:2px 6px;
      border-radius:6px;
      font-size:12px;
      background:#f3f4f6;
      color:#111;
    }

    .resultHead{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; margin: 6px 0 8px;
      font-weight:800;
      color:#111;
    }

    .statusbar{
      margin-top:10px;
      background:#ecfdf5;
      border:1px solid #bbf7d0;
      padding:10px 12px;
      border-radius:10px;
      font-weight:700;
      color:#065f46;
    }
    .statusbar.warn{
      background:#fffbeb;
      border-color:#fde68a;
      color:#92400e;
    }
    .statusbar .link{
      color:#2563eb;
      text-decoration: underline;
      cursor:pointer;
      margin-left:6px;
      font-weight:800;
    }

    .filebox{
      margin-top:12px;
      border-top:1px solid #e5e7eb;
      padding-top:12px;
    }
    .fileline{
      display:flex; flex-wrap:wrap;
      align-items:center; gap:10px;
      font-weight:700;
      color:#111;
    }
    .fileline small{ color:#6b7280; font-weight:600; }

    /* å³ä¾§ */
    .kv{
      display:grid;
      grid-template-columns: 170px 1fr;
      gap: 8px 10px;
    }
    .kv div{
      padding:6px 0;
      border-bottom:1px dashed #e5e7eb;
      color:#111;
    }
    .kv .k{ color:#6b7280; font-weight:700; }

    pre{
      margin:0;
      padding:12px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      overflow:auto;
      white-space:pre-wrap;
      word-break:break-word;
      line-height:1.45;
      font-size:12px;
      background:#fff;
      color:#111;
    }
    code{ font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; }

    .ok{ color:#15803d; font-weight:800; }
    .warnText{ color:#b45309; font-weight:800; }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
    @media (max-width:560px){ .row2{ grid-template-columns:1fr; } }
    .small{ font-size:12px; color:#6b7280; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid #e5e7eb;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color:#111;
      font-weight:700;
      background:#fff;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <div class="brand">ğŸ§© Base64 ç¼–è§£ç </div>
      <a href="/tools/" style="margin-left: auto; text-decoration: none; font-size: 16px; font-weight: bold; color: #111;">ğŸ”™ æ›´å¤šå·¥å…·</a>
    </div>

    <div class="wrap">
      <!-- å·¦ä¾§ -->
      <section class="card">
        <div class="title">è¾“å…¥æ–‡æœ¬</div>
        <div class="content">
          <div class="hintline">è¯·è¾“å…¥è¦è¿›è¡Œ Base64 ç¼–ç æˆ–è§£ç çš„å­—ç¬¦</div>

          <textarea id="mainInput" placeholder="ä¾‹å¦‚ï¼š12131 æˆ– aGVsbG8="></textarea>

          <div class="btnrow">
            <button id="encodeBtn" class="btn-primary" type="button">ç¼–ç  (Encode)</button>
            <button id="decodeBtn" class="btn-ghost" type="button">è§£ç  (Decode)</button>
            <button id="swapBtn" class="btn-ghost" type="button" aria-label="äº¤æ¢">
              <span class="swapIcon">â‡…</span>
            </button>

            <span class="shortcut">ï¼ˆç¼–/è§£ç å¿«æ·é”®ï¼š<kbd>Ctrl</kbd> + <kbd>Enter</kbd>ï¼‰</span>
          </div>

          <div class="resultHead">
            <div>ç»“æœï¼š</div>
          </div>

          <textarea id="mainOutput" placeholder="ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ" readonly></textarea>

          <div id="statusBar" class="statusbar" style="display:none;"></div>

          <div class="filebox">
            <div class="fileline">
              <span>ä¹Ÿå¯ä»¥é€‰æ‹©å›¾ç‰‡æ–‡ä»¶æ¥è·å–å®ƒçš„ Base64 ç¼–ç çš„ DataURI å½¢å¼ï¼š</span>
              <input id="fileInput" type="file" accept="image/*" />
              <small id="fileHint">æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶</small>
            </div>
            <div class="small" style="margin-top:8px;">
              è¯´æ˜ï¼šDataURI æ ¼å¼ç±»ä¼¼ <code>data:image/png;base64,....</code>ï¼ˆå›¾ç‰‡æ¨¡å¼ä»…å±•ç¤ºâ€œä¸»è¦æ­¥éª¤è¯´æ˜â€ï¼Œä¸å±•å¼€é€ä½æ¨å¯¼ï¼‰
            </div>
          </div>

          <div class="row2">
            <div>
              <span class="pill">å®‰å…¨æç¤º</span>
              <div class="small" style="margin-top:6px;">
                Base64 ä¸æ˜¯åŠ å¯†ï¼Œåªæ˜¯ç¼–ç ï¼›ä¼ è¾“å®‰å…¨è¯·ä½¿ç”¨ TLSã€‚
              </div>
            </div>
            <div>
              <span class="pill">å°æŠ€å·§</span>
              <div class="small" style="margin-top:6px;">
                è¾“å…¥çœ‹èµ·æ¥åƒ Base64 æ—¶ï¼Œ<kbd>Ctrl</kbd>+<kbd>Enter</kbd> ä¼šä¼˜å…ˆæ‰§è¡Œâ€œè§£ç â€ï¼›å¦åˆ™æ‰§è¡Œâ€œç¼–ç â€ã€‚
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- å³ä¾§ -->
      <section class="card">
        <div class="title">æ­¥éª¤è¯´æ˜/æ¨å¯¼</div>
        <div class="content">
          <div class="kv">
            <div class="k">çŠ¶æ€</div><div id="stepStatus" class="ok">ç­‰å¾…æ“ä½œ</div>
            <div class="k">å­—èŠ‚é•¿åº¦</div><div id="byteLen">-</div>
            <div class="k">Base64 é•¿åº¦</div><div id="b64Len">-</div>
            <div class="k">Padding</div><div id="padding">-</div>
            <div class="k">æœ€è¿‘ä¸€æ¬¡åŠ¨ä½œ</div><div id="lastAction">-</div>
            <div class="k">å±•ç¤ºçº§åˆ«</div><div id="detailLevel">-</div>
          </div>

          <div style="margin-top:12px;">
            <label class="small">æ­¥éª¤å†…å®¹</label>
            <pre id="steps"><code>ç‚¹å‡»å·¦ä¾§â€œç¼–ç /è§£ç â€ï¼Œè¿™é‡Œä¼šå±•ç¤ºæ­¥éª¤è¯´æ˜ã€‚
- æ–‡æœ¬ï¼šå±•ç¤ºè¯¦ç»†æ¨å¯¼ï¼ˆå­—èŠ‚â†’bitâ†’6bitâ†’ç´¢å¼•â†’å­—ç¬¦ï¼‰
- å›¾ç‰‡(DataURI)ï¼šä»…å±•ç¤ºä¸»è¦æ­¥éª¤è¯´æ˜ï¼ˆä¸é€ä½å±•å¼€ï¼‰</code></pre>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
(() => {
  const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  const $ = (id) => document.getElementById(id);

  const mainInput = $("mainInput");
  const mainOutput = $("mainOutput");
  const encodeBtn = $("encodeBtn");
  const decodeBtn = $("decodeBtn");
  const swapBtn = $("swapBtn");
  const statusBar = $("statusBar");

  const fileInput = $("fileInput");
  const fileHint = $("fileHint");

  // å³ä¾§
  const stepStatus = $("stepStatus");
  const byteLenEl = $("byteLen");
  const b64LenEl = $("b64Len");
  const paddingEl = $("padding");
  const lastActionEl = $("lastAction");
  const detailLevelEl = $("detailLevel");
  const stepsEl = $("steps");

  const encoder = new TextEncoder();
  const decoder = new TextDecoder("utf-8", { fatal: false });

  function setStepStatus(ok, msg) {
    stepStatus.className = ok ? "ok" : "warnText";
    stepStatus.textContent = msg;
  }

  function showStatusBar(text, kind = "ok") {
    statusBar.style.display = "block";
    statusBar.classList.toggle("warn", kind !== "ok");
    statusBar.innerHTML = text;
  }
  function clearStatusBar() {
    statusBar.style.display = "none";
    statusBar.textContent = "";
    statusBar.classList.remove("warn");
  }

  function bytesToHex(bytes) {
    return Array.from(bytes).map(b => b.toString(16).padStart(2,"0")).join("");
  }

  function base64Encode(bytes) {
    let out = "";
    for (let i=0;i<bytes.length;i+=3) {
      const a = bytes[i];
      const b = (i+1<bytes.length) ? bytes[i+1] : 0;
      const c = (i+2<bytes.length) ? bytes[i+2] : 0;

      const triple = (a<<16) | (b<<8) | c;

      const idx1 = (triple >> 18) & 63;
      const idx2 = (triple >> 12) & 63;
      const idx3 = (triple >> 6) & 63;
      const idx4 = triple & 63;

      out += ALPHABET[idx1];
      out += ALPHABET[idx2];
      out += (i+1<bytes.length) ? ALPHABET[idx3] : "=";
      out += (i+2<bytes.length) ? ALPHABET[idx4] : "=";
    }
    return out;
  }

  function base64DecodeToBytes(b64) {
    const clean = b64.trim().replace(/\s+/g, "");
    if (clean.length === 0) return new Uint8Array([]);
    if (clean.length % 4 !== 0) throw new Error("Base64 é•¿åº¦å¿…é¡»æ˜¯ 4 çš„å€æ•°ï¼ˆå¯åŒ…å« '=' paddingï¼‰ã€‚");

    const pad = (clean.endsWith("==") ? 2 : clean.endsWith("=") ? 1 : 0);
    const len = (clean.length * 3) / 4 - pad;
    const out = new Uint8Array(len);

    let outIdx = 0;
    for (let i=0;i<clean.length;i+=4) {
      const c1 = clean[i], c2 = clean[i+1], c3 = clean[i+2], c4 = clean[i+3];
      const i1 = ALPHABET.indexOf(c1);
      const i2 = ALPHABET.indexOf(c2);
      const i3 = (c3 === "=") ? 0 : ALPHABET.indexOf(c3);
      const i4 = (c4 === "=") ? 0 : ALPHABET.indexOf(c4);

      if (i1 < 0 || i2 < 0 || (c3 !== "=" && i3 < 0) || (c4 !== "=" && i4 < 0)) {
        throw new Error("Base64 åŒ…å«éæ³•å­—ç¬¦ï¼ˆåªèƒ½ A-Z a-z 0-9 + / ä»¥åŠ '='ï¼‰ã€‚");
      }

      const triple = (i1<<18) | (i2<<12) | (i3<<6) | i4;

      if (outIdx < len) out[outIdx++] = (triple >> 16) & 255;
      if (c3 !== "=" && outIdx < len) out[outIdx++] = (triple >> 8) & 255;
      if (c4 !== "=" && outIdx < len) out[outIdx++] = triple & 255;
    }
    return out;
  }

  function isLikelyDataURIImage(s) {
    const t = (s || "").trim();
    return /^data:image\/[a-zA-Z0-9.+-]+;base64,/.test(t);
  }

  function explainEncodeDetailed(bytes) {
    const hex = bytesToHex(bytes);
    const bits8 = Array.from(bytes).map(b => b.toString(2).padStart(8,"0"));

    const chunks24 = [];
    for (let i=0;i<bytes.length;i+=3) {
      const slice = bytes.slice(i, i+3);
      const sliceBits = Array.from(slice).map(b => b.toString(2).padStart(8,"0")).join("");
      chunks24.push({ slice, sliceBits });
    }

    const mod = bytes.length % 3;
    const pad = mod === 0 ? 0 : (3 - mod);
    const paddingStr = pad === 0 ? "(æ— )" : "=".repeat(pad);

    let charsAll = [];

    const perChunkLines = chunks24.map((c, ci) => {
      const paddedBits = c.sliceBits.padEnd(24, "0");
      const groups6 = [];
      const idxs = [];
      const chars = [];

      for (let j=0;j<24;j+=6) {
        const g = paddedBits.slice(j,j+6);
        groups6.push(g);
        const idx = parseInt(g, 2);
        idxs.push(idx);
        chars.push(ALPHABET[idx]);
      }

      if (ci === chunks24.length - 1 && pad > 0) {
        for (let k=0;k<pad;k++) chars[chars.length-1-k] = "=";
      }

      charsAll.push(...chars);

      const sliceHex = bytesToHex(c.slice);
      const slice8 = Array.from(c.slice).map(b => b.toString(2).padStart(8,"0")).join(" ");

      return [
        `å— ${ci+1}: è¾“å…¥å­—èŠ‚(hex)=${sliceHex || "(ç©º)"} | 8bit=${slice8 || "(ç©º)"}`,
        `      24bit(ä¸è¶³è¡¥0)=${paddedBits || "(ç©º)"}`,
        `      6bitåˆ†ç»„=${groups6.join(" ") || "(ç©º)"}`,
        `      ç´¢å¼•=${idxs.map(x => String(x).padStart(2," ")).join(" ") || "(ç©º)"}`,
        `      Base64å­—ç¬¦=${chars.join(" ") || "(ç©º)"}`
      ].join("\n");
    }).join("\n");

    const b64 = base64Encode(bytes);

    return {
      b64,
      paddingStr,
      stepsText:
`ã€ç¼–ç -è¯¦ç»†æ¨å¯¼ï¼ˆæ–‡æœ¬ï¼‰ã€‘
1) UTF-8 â†’ å­—èŠ‚æµï¼ˆhexï¼‰:
   ${hex || "(ç©º)"}
2) æ¯å­—èŠ‚ 8bit æ‹¼æ¥:
   ${bits8.length ? bits8.join(" ") : "(ç©º)"}
3) æ¯ 3 å­—èŠ‚(24bit) åˆ†å—ï¼Œå¹¶æŒ‰ 6bit åˆ†ç»„:
${perChunkLines || "(ç©º)"}
4) ç´¢å¼• â†’ Base64å­—ç¬¦ï¼ˆæœ«å°¾å¯èƒ½è¡¥ '='ï¼‰:
   ${charsAll.length ? charsAll.join("") : "(ç©º)"}
5) è¾“å‡º Base64:
   ${b64}`
    };
  }

  function explainDecodeDetailed(b64Input) {
    const cleaned = b64Input.trim().replace(/\s+/g, "");
    if (cleaned.length === 0) {
      return { text: "", bytes: new Uint8Array([]), pad: 0, stepsText:
`ã€è§£ç -è¯¦ç»†æ¨å¯¼ï¼ˆæ–‡æœ¬ï¼‰ã€‘
1) è¾“å…¥ Base64: (ç©º)
2) è¿‡æ»¤ç©ºç™½å: (ç©º)
3) 4å­—ç¬¦ä¸€ç»„ â†’ ç´¢å¼•(=å¿½ç•¥) â†’ 6bit:
   (ç©º)
4) 6bit æ‹¼æ¥ â†’ 8bit å­—èŠ‚æµ:
   (ç©º)
5) UTF-8 è§£ç è¾“å‡º:
   (ç©º)`
      };
    }
    if (cleaned.length % 4 !== 0) throw new Error("Base64 é•¿åº¦å¿…é¡»æ˜¯ 4 çš„å€æ•°ï¼ˆå¯åŒ…å« '=' paddingï¼‰ã€‚");

    const padCount = (cleaned.endsWith("==") ? 2 : cleaned.endsWith("=") ? 1 : 0);

    const groups4 = [];
    for (let i=0;i<cleaned.length;i+=4) groups4.push(cleaned.slice(i,i+4));

    const perGroupLines = [];
    groups4.forEach((g, gi) => {
      const chars = g.split("");
      const idxs = chars.map(ch => ch === "=" ? null : ALPHABET.indexOf(ch));
      if (idxs.some(x => x === -1)) throw new Error("Base64 åŒ…å«éæ³•å­—ç¬¦ï¼ˆåªèƒ½ A-Z a-z 0-9 + / ä»¥åŠ '='ï¼‰ã€‚");

      const bits6 = idxs.map(x => x === null ? null : x.toString(2).padStart(6,"0"));
      const joined6 = bits6.filter(x => x !== null).join("");

      const bytes = [];
      for (let i=0;i<joined6.length;i+=8) {
        const b = joined6.slice(i,i+8);
        if (b.length === 8) bytes.push(parseInt(b,2));
      }

      perGroupLines.push(
        `ç»„ ${gi+1}: Base64=${g}\n` +
        `      ç´¢å¼•(=å¿½ç•¥)=${idxs.map(x => x===null ? " =" : String(x).padStart(2," ")).join(" ")}\n` +
        `      6bit(=å¿½ç•¥)=${bits6.map(x => x===null ? "======": x).join(" ")}\n` +
        `      æ‹¼æ¥6bit=${joined6 || "(ç©º)"}\n` +
        `      è¿˜åŸå­—èŠ‚(hex)=${bytes.map(b => b.toString(16).padStart(2,"0")).join("") || "(ç©º)"}`
      );
    });

    const bytesFinal = base64DecodeToBytes(cleaned);
    const text = decoder.decode(bytesFinal);

    return {
      text,
      bytes: bytesFinal,
      pad: padCount,
      stepsText:
`ã€è§£ç -è¯¦ç»†æ¨å¯¼ï¼ˆæ–‡æœ¬ï¼‰ã€‘
1) è¾“å…¥ Base64:
   ${b64Input}
2) è¿‡æ»¤ç©ºç™½å:
   ${cleaned}
3) 4å­—ç¬¦ä¸€ç»„ â†’ ç´¢å¼• & 6bitï¼ˆé€ç»„å±•ç¤ºï¼‰:
${perGroupLines.join("\n")}

4) 6bit æ‹¼æ¥ â†’ 8bit å­—èŠ‚æµï¼ˆæœ€ç»ˆï¼‰:
   hex=${bytesToHex(bytesFinal) || "(ç©º)"}
5) UTF-8 è§£ç è¾“å‡º:
   ${text || "(ç©º)"}`
    };
  }

  function explainImageBrief() {
    return `ã€å›¾ç‰‡(DataURI) - ä¸»è¦æ­¥éª¤è¯´æ˜ï¼ˆç®€ç‰ˆï¼‰ã€‘
1) è¯»å–å›¾ç‰‡æ–‡ä»¶çš„äºŒè¿›åˆ¶å†…å®¹ï¼ˆbytesï¼‰
2) Base64 ç¼–ç ï¼šæ¯ 3 å­—èŠ‚ â†’ 4 ä¸ªå­—ç¬¦ï¼Œä¸è¶³è¡¥ '='
3) æ‹¼æ¥ DataURIï¼šdata:image/<type>;base64, + Base64å†…å®¹
4) è¾“å‡ºå¯ç›´æ¥ç”¨äºç½‘é¡µçš„ DataURIï¼ˆimg.src / CSS background-imageï¼‰`;
  }

  function updateRightPanel({ ok, status, byteLen, b64Len, padding, steps, lastAction, detailLevel }) {
    setStepStatus(ok, status);
    byteLenEl.textContent = byteLen ?? "-";
    b64LenEl.textContent = b64Len ?? "-";
    paddingEl.textContent = padding ?? "-";
    stepsEl.textContent = steps ?? "";
    lastActionEl.textContent = lastAction ?? "-";
    detailLevelEl.textContent = detailLevel ?? "-";
  }

  function doEncode() {
    try {
      clearStatusBar();
      const raw = mainInput.value;

      // DataURI å›¾ç‰‡ï¼šä¸å±•å¼€ç»†èŠ‚
      if (isLikelyDataURIImage(raw)) {
        mainOutput.value = raw;
        showStatusBar(`æ£€æµ‹åˆ°å›¾ç‰‡ DataURIï¼šå®ƒæœ¬èº«å·²åŒ…å« Base64ã€‚å·²åŸæ ·è¾“å‡ºã€‚`, "ok");

        updateRightPanel({
          ok: true,
          status: "å›¾ç‰‡æ¨¡å¼ï¼šæ­¥éª¤è¯´æ˜ï¼ˆç®€ç‰ˆï¼‰",
          byteLen: "-",
          b64Len: String(raw.length),
          padding: "-",
          steps: explainImageBrief(),
          lastAction: "ç¼–ç  (å›¾ç‰‡/DataURI)",
          detailLevel: "ç®€ç‰ˆè¯´æ˜"
        });
        return;
      }

      const bytes = encoder.encode(raw);
      const exp = explainEncodeDetailed(bytes);
      mainOutput.value = exp.b64;

      showStatusBar(
        `ç¼–ç å®Œæ¯•ï¼ŒåŸæ–‡å­—èŠ‚æ•°ï¼š${bytes.length}ï¼Œç¼–ç åå­—èŠ‚æ•°ï¼š${exp.b64.length}ã€‚` +
        `<span class="link" id="copyLink">å¤åˆ¶ç»“æœ</span>`,
        "ok"
      );

      updateRightPanel({
        ok: true,
        status: "ç¼–ç å®Œæˆ",
        byteLen: String(bytes.length),
        b64Len: String(exp.b64.length),
        padding: exp.paddingStr,
        steps: exp.stepsText,
        lastAction: "ç¼–ç  (æ–‡æœ¬)",
        detailLevel: "è¯¦ç»†æ¨å¯¼"
      });

      document.getElementById("copyLink")?.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(mainOutput.value);
          showStatusBar(`å·²å¤åˆ¶ç»“æœåˆ°å‰ªè´´æ¿ã€‚`, "ok");
        } catch {
          showStatusBar(`å¤åˆ¶å¤±è´¥ï¼šæµè§ˆå™¨å¯èƒ½ç¦æ­¢å‰ªè´´æ¿è®¿é—®ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚`, "warn");
        }
      });

    } catch (e) {
      showStatusBar(`ç¼–ç å¤±è´¥ï¼š${e.message || String(e)}`, "warn");
      updateRightPanel({ ok:false, status: e.message || String(e), lastAction:"ç¼–ç å¤±è´¥", detailLevel:"-" });
    }
  }

  function doDecode() {
    try {
      clearStatusBar();
      const raw = mainInput.value;

      if (isLikelyDataURIImage(raw)) {
        const idx = raw.indexOf("base64,");
        const b64 = idx >= 0 ? raw.slice(idx + "base64,".length) : "";
        mainOutput.value = b64;

        showStatusBar(`å·²ä» DataURI æå– Base64 å†…å®¹ï¼ˆè¾“å‡ºåŒºä¸º Base64 éƒ¨åˆ†ï¼‰ã€‚`, "ok");

        updateRightPanel({
          ok: true,
          status: "å›¾ç‰‡æ¨¡å¼ï¼šæ­¥éª¤è¯´æ˜ï¼ˆç®€ç‰ˆï¼‰",
          byteLen: "-",
          b64Len: String(b64.length),
          padding: b64.endsWith("==") ? "==" : b64.endsWith("=") ? "=" : "(æ— /æœªçŸ¥)",
          steps: explainImageBrief(),
          lastAction: "è§£ç  (å›¾ç‰‡/DataURI)",
          detailLevel: "ç®€ç‰ˆè¯´æ˜"
        });
        return;
      }

      const exp = explainDecodeDetailed(raw);
      mainOutput.value = exp.text;

      const cleanedLen = raw.trim().replace(/\s+/g,"").length;
      showStatusBar(`è§£ç å®Œæ¯•ï¼ŒBase64é•¿åº¦ï¼š${cleanedLen}ï¼Œè¾“å‡ºå­—èŠ‚æ•°ï¼š${exp.bytes.length}ã€‚`, "ok");

      updateRightPanel({
        ok: true,
        status: "è§£ç å®Œæˆï¼ˆæŒ‰ UTF-8 æ˜¾ç¤ºï¼‰",
        byteLen: String(exp.bytes.length),
        b64Len: String(cleanedLen),
        padding: exp.pad ? "=".repeat(exp.pad) : "(æ— )",
        steps: exp.stepsText,
        lastAction: "è§£ç  (æ–‡æœ¬/Base64)",
        detailLevel: "è¯¦ç»†æ¨å¯¼"
      });

    } catch (e) {
      showStatusBar(`è§£ç å¤±è´¥ï¼š${e.message || String(e)}`, "warn");
      updateRightPanel({ ok:false, status: e.message || String(e), lastAction:"è§£ç å¤±è´¥", detailLevel:"-" });
    }
  }

  function doSwap() {
    const a = mainInput.value;
    mainInput.value = mainOutput.value;
    mainOutput.value = a;
    showStatusBar(`å·²äº¤æ¢è¾“å…¥ä¸è¾“å‡ºã€‚`, "ok");
    updateRightPanel({ ok:true, status:"å·²äº¤æ¢è¾“å…¥ä¸è¾“å‡º", lastAction:"äº¤æ¢", detailLevel:"-" });
  }

  function onShortcut(e) {
    if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
      const s = mainInput.value.trim();
      const looksLikeB64 =
        s.length >= 4 &&
        s.length % 4 === 0 &&
        /^[A-Za-z0-9+\/=\s]+$/.test(s);

      if (looksLikeB64) doDecode();
      else doEncode();
      e.preventDefault();
    }
  }

  function onFileChange() {
    const f = fileInput.files?.[0];
    if (!f) {
      fileHint.textContent = "æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶";
      return;
    }
    fileHint.textContent = f.name;

    const reader = new FileReader();
    reader.onload = () => {
      const dataUrl = String(reader.result || "");
      mainInput.value = dataUrl;
      showStatusBar(`å·²è¯»å–å›¾ç‰‡å¹¶ç”Ÿæˆ DataURIï¼ˆå·²å†™å…¥è¾“å…¥æ¡†ï¼‰ã€‚`, "ok");

      updateRightPanel({
        ok: true,
        status: "å·²ç”Ÿæˆå›¾ç‰‡ DataURI",
        byteLen: "-",
        b64Len: String(dataUrl.length),
        padding: "-",
        steps: explainImageBrief(),
        lastAction: "é€‰æ‹©å›¾ç‰‡æ–‡ä»¶",
        detailLevel: "ç®€ç‰ˆè¯´æ˜"
      });
    };
    reader.onerror = () => showStatusBar(`è¯»å–æ–‡ä»¶å¤±è´¥ã€‚`, "warn");
    reader.readAsDataURL(f);
  }

  encodeBtn.addEventListener("click", doEncode);
  decodeBtn.addEventListener("click", doDecode);
  swapBtn.addEventListener("click", doSwap);
  document.addEventListener("keydown", onShortcut);
  fileInput.addEventListener("change", onFileChange);

  // åˆå§‹åŒ–ç¤ºä¾‹
  mainInput.value = "12131";
  updateRightPanel({ ok:true, status:"ç­‰å¾…æ“ä½œ", lastAction:"-", detailLevel:"-" });
})();
</script>
</body>
</html>
